(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[361],{5094:function(e,t,r){Promise.resolve().then(r.bind(r,4777))},4777:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(7437),o=r(4103),a=r(3023),s=r(6110),i=r(4033);function l(){let{user:e,isLoading:t,logout:r}=(0,o.useAuth)(),l=(0,i.useRouter)();return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:(0,n.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Authentication Debug Page"}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)(s.Zb,{children:[(0,n.jsxs)(s.Ol,{children:[(0,n.jsx)(s.ll,{children:"Current Auth State"}),(0,n.jsx)(s.SZ,{children:"Current authentication status and user data"})]}),(0,n.jsxs)(s.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Loading:"})," ",t?"Yes":"No"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User:"})," ",e?JSON.stringify(e,null,2):"null"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Cookies:"}),(0,n.jsx)("pre",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded text-xs mt-1 overflow-auto",children:"undefined"!=typeof document?document.cookie:"N/A (server-side)"})]})]})]}),(0,n.jsxs)(s.Zb,{children:[(0,n.jsxs)(s.Ol,{children:[(0,n.jsx)(s.ll,{children:"Debug Actions"}),(0,n.jsx)(s.SZ,{children:"Actions to test and reset authentication"})]}),(0,n.jsx)(s.aY,{className:"space-y-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsx)(a.z,{onClick:()=>{document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="userEmail=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",localStorage.clear(),sessionStorage.clear(),console.log("\uD83E\uDDF9 All auth data cleared"),window.location.reload()},variant:"destructive",children:"\uD83E\uDDF9 Force Reset All Auth Data"}),(0,n.jsx)(a.z,{onClick:()=>r(),variant:"outline",children:"\uD83D\uDEAA Normal Logout"}),(0,n.jsx)(a.z,{onClick:()=>{window.location.href="/login"},variant:"default",children:"\uD83D\uDD11 Force Navigate to Login"}),(0,n.jsx)(a.z,{onClick:()=>{window.location.href="/dashboard"},variant:"secondary",children:"\uD83D\uDCCA Force Navigate to Dashboard"}),(0,n.jsx)(a.z,{onClick:()=>l.push("/login"),variant:"outline",children:"\uD83D\uDD11 Router Push to Login"}),(0,n.jsx)(a.z,{onClick:()=>l.push("/dashboard"),variant:"outline",children:"\uD83D\uDCCA Router Push to Dashboard"})]})})]})]})]})})}},3023:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var n=r(7437),o=r(2265),a=r(7256),s=r(6061),i=r(9311);let l=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=o.forwardRef((e,t)=>{let{className:r,variant:o,size:s,asChild:c=!1,...u}=e,d=c?a.g7:"button";return(0,n.jsx)(d,{className:(0,i.cn)(l({variant:o,size:s,className:r})),ref:t,...u})});c.displayName="Button"},6110:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return s},aY:function(){return u},eW:function(){return d},ll:function(){return l}});var n=r(7437),o=r(2265),a=r(9311);let s=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...o})});s.displayName="Card";let i=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...o})});i.displayName="CardHeader";let l=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...o})});l.displayName="CardTitle";let c=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...o})});c.displayName="CardDescription";let u=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...o})});u.displayName="CardContent";let d=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...o})});d.displayName="CardFooter"},4103:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return g},useAuth:function(){return h}});var n=r(7437),o=r(2265),a=r(4033),s=r(4829),i=r(1490),l=r(2601);let c=s.Z.create({baseURL:l.env.NEXT_PUBLIC_API_URL||"/api",headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{let t=i.Z.get("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),c.interceptors.response.use(e=>e,e=>{var t;let r="An unexpected error occurred";if(null===(t=e.response)||void 0===t?void 0:t.data){let t=e.response.data;t.detail?r=t.detail:t.message?r=t.message:"string"==typeof t&&(r=t)}else e.message&&(r=e.message);let n=Error(r);return n.name="APIError",Promise.reject(n)});var u={login:async e=>{try{let t=new URLSearchParams;t.append("username",e.email),t.append("password",e.password);let r=await c.post("/auth/login",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});return r.data}catch(e){throw e}},signup:async e=>{try{let t=await c.post("/auth/register",e);return t.data}catch(e){throw e}},logout:async()=>{i.Z.remove("token")},getCurrentUser:async()=>{try{return null}catch(e){throw e}},getAllUsers:async()=>{try{let e=await c.get("/auth/db");if(e.data&&e.data["Hello From: "])return e.data["Hello From: "];return e.data}catch(e){throw e}}};let d=(0,o.createContext)(void 0);function g(e){let{children:t}=e,[r,s]=(0,o.useState)(null),[l,c]=(0,o.useState)(!0),g=(0,a.useRouter)(),h=(0,a.useSearchParams)(),f=()=>{console.log("\uD83D\uDD04 Clearing authentication data..."),i.Z.remove("token"),i.Z.remove("userEmail"),s(null)};(0,o.useEffect)(()=>{console.log("\uD83D\uDD0D AuthProvider: Checking authentication status...");let e=i.Z.get("token"),t=i.Z.get("userEmail");console.log("\uD83C\uDF6A Found cookies:",{hasToken:!!e,userEmail:t?"".concat(t.substring(0,3),"***"):"none"}),e&&t?(console.log("\uD83D\uDD04 Attempting to authenticate with stored credentials..."),u.getAllUsers().then(e=>{console.log("\uD83D\uDC65 Fetched ".concat(e.length," users from API"));let r=e.find(e=>e.email===t);r?(console.log("✅ User found in API, logging in:",r.email),s(r)):(console.log("❌ User not found in API, clearing tokens"),f())}).catch(e=>{console.log("❌ Failed to fetch users, clearing tokens:",e.message),f()}).finally(()=>{c(!1)})):(console.log("\uD83D\uDC64 No authentication found, user not logged in"),c(!1))},[]);let m=async(e,t)=>{try{console.log("\uD83D\uDD10 Attempting login for:",e);let r=await u.login({email:e,password:t});console.log("✅ Login successful, storing credentials"),i.Z.set("token",r.access_token,{expires:30}),i.Z.set("userEmail",e,{expires:30});try{let t=await u.getAllUsers(),r=t.find(t=>t.email===e);r&&(console.log("✅ User data retrieved from API"),s(r))}catch(t){console.log("⚠️ Could not fetch user data, creating basic user object"),s({id:"unknown",email:e,first_name:"",last_name:""})}let n=h.get("from")||"/dashboard";g.push(n)}catch(e){throw console.log("❌ Login failed:",e),e}},p=async(e,t,r,n)=>{try{console.log("\uD83D\uDCDD Attempting signup for:",r),await u.signup({email:r,password:n,first_name:e,last_name:t}),console.log("✅ Signup successful, auto-logging in..."),await m(r,n)}catch(e){throw console.log("❌ Signup failed:",e),e}},x=async()=>{try{console.log("\uD83D\uDEAA Logging out..."),await u.logout(),f(),g.push("/")}catch(e){console.log("⚠️ Logout error, clearing local state anyway:",e),f(),g.push("/")}};return(0,n.jsx)(d.Provider,{value:{user:r,isLoading:l,login:m,signup:p,logout:x,clearAuth:f},children:t})}function h(){let e=(0,o.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9311:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var n=r(7042),o=r(4769);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.m6)((0,n.W)(t))}}},function(e){e.O(0,[621,930,971,590,744],function(){return e(e.s=5094)}),_N_E=e.O()}]);